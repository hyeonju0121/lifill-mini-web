<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
	
<mapper namespace="com.mycompany.lifill_mini_web.dao.ProductResponseDao">

	<select id="prdselect" resultType="ProductResponse">
		select   t3.prdcode, t4.prdname, t4.prdbrand, t4.prdprice, t4.prdstock,
		         t4.prdimgrep1oname, t4.prdimgrep1type,
		         t4.prdimgdetailoname, t4.prdimgdetailtype,
		         t4.prdcreatedat,
		         t3.fnno, t3.fnval, t3.igdno, t3.igdval
		from (
		        select t1.prdcode, fnno, fnval, igdno, igdval
		        from (
		                select p.prdcode, i.igdno, i.igdval
		                from product p, ingredient i
		                where p.igdno=i.igdno
		             ) t1, (
		                select p.prdcode, f.fnno, f.fnval
		                from product p, function f
		                where p.fnno=f.fnno
		             ) t2
		        where t1.prdcode = t2.prdcode
		    ) t3, (
		                select t1.prdcode, t1.prdname, t1.prdbrand, t1.prdprice, t1.prdstock,
		                     prdcontents.prdimgrep1oname, prdcontents.prdimgrep1type,
		                     prdcontents.prdimgdetailoname, prdcontents.prdimgdetailtype,
		                     prdcontents.prdcreatedat
		                from 
		                    prdcontents, 
		                    (
		                        select p.prdcode, p.fnno, p.prdname, p.prdbrand, p.prdprice, p.prdstock
		                        from product p , prddetail pd
		                        where p.prdcode=pd.prdcode
		                    ) t1
		                where prdcontents.prdcode=t1.prdcode
		                order by prdcontents.prdcreatedat
		            ) t4
		where t3.prdcode=t4.prdcode
		
	</select>
	
	<select id="prdSelectByPrdcode" parameterType="String" resultType="ProductResponse">
		select   t3.prdcode, t4.prdname, t4.prdbrand, t4.prdprice, t4.prdstock,
		         t4.prdimgrep1oname, t4.prdimgrep1type,
		         t4.prdimgdetailoname, t4.prdimgdetailtype,
		         t4.prdcreatedat,
		         t3.fnno, t3.fnval, t3.igdno, t3.igdval
		from (
		        select t1.prdcode, fnno, fnval, igdno, igdval
		        from (
		                select p.prdcode, i.igdno, i.igdval
		                from product p, ingredient i
		                where p.igdno=i.igdno
		             ) t1, (
		                select p.prdcode, f.fnno, f.fnval
		                from product p, function f
		                where p.fnno=f.fnno
		             ) t2
		        where t1.prdcode = t2.prdcode
		    ) t3, (
		                select t1.prdcode, t1.prdname, t1.prdbrand, t1.prdprice, t1.prdstock,
		                     prdcontents.prdimgrep1oname, prdcontents.prdimgrep1type,
		                     prdcontents.prdimgdetailoname, prdcontents.prdimgdetailtype,
		                     prdcontents.prdcreatedat
		                from 
		                    prdcontents, 
		                    (
		                        select p.prdcode, p.fnno, p.prdname, p.prdbrand, p.prdprice, p.prdstock
		                        from product p , prddetail pd
		                        where p.prdcode=pd.prdcode
		                    ) t1
		                where prdcontents.prdcode=t1.prdcode
		                order by prdcontents.prdcreatedat
		            ) t4
		where t3.prdcode=t4.prdcode
		and t3.prdcode=#{prdcode}
	</select>
	
	<select id="prdSelectByAttachData" parameterType="String" resultType="ProductResponse">
		select   t4.prdimgrep1
		from (
		        select t1.prdcode, fnno, fnval, igdno, igdval
		        from (
		                select p.prdcode, i.igdno, i.igdval
		                from product p, ingredient i
		                where p.igdno=i.igdno
		             ) t1, (
		                select p.prdcode, f.fnno, f.fnval
		                from product p, function f
		                where p.fnno=f.fnno
		             ) t2
		        where t1.prdcode = t2.prdcode
		    ) t3, (
		                select t1.prdcode, t1.prdname, t1.prdbrand, t1.prdprice, t1.prdstock,
		                     prdcontents.prdimgrep1, prdcontents.prdimgrep1oname, prdcontents.prdimgrep1type,
		                     prdcontents.prdimgdetailoname, prdcontents.prdimgdetailtype,
		                     prdcontents.prdcreatedat
		                from 
		                    prdcontents, 
		                    (
		                        select p.prdcode, p.fnno, p.prdname, p.prdbrand, p.prdprice, p.prdstock
		                        from product p , prddetail pd
		                        where p.prdcode=pd.prdcode
		                    ) t1
		                where prdcontents.prdcode=t1.prdcode
		                order by prdcontents.prdcreatedat
		            ) t4
		where t3.prdcode=t4.prdcode
		and t3.prdcode=#{prdcode}
	</select>
	
	
	
</mapper>